# Interview Six：mysql

- innodb文件系统
    - 文件、db页大小、磁盘块
    - 行格式
    - 完全行溢出
- 索引
    - 聚簇/非聚簇索引
    - 覆盖索引、回表
    - 最左匹配法则、索引下推
    - 索引类型、种类
    - `索引失效场景、索引不适用场景`
- db锁
    - 排它锁（写锁）、共享锁（读锁）
    - 行锁、表锁
- ACID
    - 事务隔离级别
    - MVCC
- 分库分表
    - 垂直分、水平分
    - ID唯一、sharding_key
    - 非sharding_key的查询
- Mysql主从同步
    - 线程模型
    - 异步、半同步、全同步
    - 内部XA

# **1. innodb的文件系统**

在innodb文件系统中，一个表使用一个.ibd文件进行存储，表空间由若干个页组成，以**页作为磁盘和内存的基本交互单位**

数据索引页：页默认大小为16KB，数据和索引放在同一个结构中，并建立起聚簇索引

磁盘块：默认大小为4KB

所以一个.ibd文件的大小为16的倍数，B+树的每个节点至少为一个页大小

# **2. 聊聊db索引**

先介绍聚簇索引，通过聚簇索引来引申出innodb的数据存储结构，以及聚簇索引相比非聚簇索引的优势，其他问题等待询问

## **2.1 db有哪些类型的索引？**

索引按照结构类型来讲，主要包含：B+树和Hash索引

- B+树索引：使用B+树组织数据，非叶子节点存放`索引列 + 指针`，叶子节点存放`索引列 + 数据`，叶子节点之间**通过前/后指针链接**形成双向链表
        
    - 优点：

        - 有序：数据在逻辑上为`索引列值有序`

        - 高扇出性：由于非叶子节点并不保存数据，相比B树和二叉搜索树可以存储更多的指针，B+树一般不会超过4层，而**越低的高度代表着更少的I/O次数**

    > 一张表只能有一个聚簇索引，默认为主键，若没有定义主键则选择一个唯一的非空索引代替，再没有则隐式定义一个主键，将其作为聚簇索引

- hash索引：使用散列表组织数据，通过对索引列值哈希计算，以O(1)时间复杂度得到表中指向数据行的**指针元素**

    - 优点：

        - 占用空间小：自身只存储指针，可以直接读入到内存中

        - 精确匹配：包含索引所有列的查询，可以达到O(1)

    - 缺点：

        - 无序：只支持等值查询，不支持任何范围的查找

        - `最左匹配无效`：由于散列表是根据索引列计算生成的，所以必须精确匹配索引列才能生效

聚簇索引：**真实数据和索引在一起存储**，其他类型如：myisam索引（数据地址）、innodb二级索引（主键值），都叫做非聚簇索引

## **2.2 覆盖索引/回表**

## **2.3 最左前缀匹配/索引下推**

## **2.4 索引种类**

## **2.5 索引失效/不适用场景**

# 参考
- [数据库索引的知识点](https://segmentfault.com/a/1190000023314270)：索引类型（按结构划分）、聚簇索引、非聚簇索引、覆盖索引、索引种类（按作用范围）、最左匹配法则、`索引失效场景`、`索引不适用场景`

- [为什么使用B+树](https://zhuanlan.zhihu.com/p/81273236)

# 重点参考
- [mysql 物理顺序_实验：innodb 的存储顺序是否完全物理无关？](https://blog.csdn.net/weixin_35531726/article/details/113441137)：innodb在ibd文件中存储的数据，无论是页之间还是页内记录都是**物理顺序无关**的，页内记录的物理无关只限制在页内，不能跨越到其他页中