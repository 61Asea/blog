# ***ACID、CAP、Base理论***

## ***1. ACID***

A（原子性），C（一致性），I（隔离性），D（持久性），是单数据库的事务处理系统基本准则。

### ***A-原子性***
事务的操作要么全部成功（commit），要么全部失败（Rollback）

### ***C-一致性***
数据在同步不同的事务的操作下，从一个状态跳转到另外一个状态，单个事务的前后数据库都是处于一致性状态

### ***I-隔离性***
并发而言，并发事务是相互隔离的，一般有4个隔离级别，关系型数据库一般为读已提交隔离级别，假设A、B、C三个事务并发，且共享数据，事务读取值会在一开始读取，在事务操作过程中也会进行读取。
- 读未提交，B事务可以在整个过程中，读到A事务过程中所产生的中间值，即为脏读
- 读已提交，假设A事务与B事务并发并共享数据，B事务只能读取到A事务结束产生的结果，但这也意味着在操作过程中，还是可能会出现出现读取的数据不一致的情况，即B过程中不可重复读。
- 可重复读，解决了读已提交的问题，但也还是解决不了幻读问题，因为事务C可能不是修改数据，而是新增数据，这已经超出了事务B的覆盖范围，若C比B更早结束，则B事务执行成功后。会发现产生了不符合预期的数据
- 串行化，解决上述全部问题，但是性能堪忧

### ***D-持久化***
commit，保证一定会写入到磁盘中，不管是否直接断电，也会在断电后重试事务。

## ***2. CAP***

C（一致性），A（可用性），P（分区容错性），CAP定义了只能选择其二实现，不能三者兼顾

放到分布式环境下思考，P是必须具备的，因为网络是不可能百分之百可靠的，所以分区是必然现象，除非你假设分区不会存在，那么符合AC系统的具体范式就是单机集中式应用，***全部数据都放在同一个节点上***

为了解决分区导致的问题，需要在CP与AP之间做出妥协，CP追求数据一致，会导致禁止写入操作，导致系统在某个时间段为不可用；AP追求系统的可用性，会导致各个服务形成孤岛。

### ***P-分区容错性***
因为网络的不确定因素，将会导致部分节点产生不可连接状态，这种情况我们称为**脑裂**，即为分区问题。

加强分区的容错性，也就是加强当网络因素导致的脑裂情况下，系统能照常或出现可接受延迟性处理。一般会将数据备份多份到不同的节点上。

但当出现了网络分区，原本需要整个分布式系统完成的工作可能就分配到了只有一小部分的可用分区完成，即使不可用的分区可以迅速恢复到可用状态，但必然会导致不同分区数据不一致的情况。

所以，我们一般假设P是常量，那么由于满足P而引入的问题，我们需要通过权衡C和P去解决

### ***C-一致性***
有强有弱之分
- 强一致性认为当出现数据不一致情况下，会禁止写入，即阻塞其他写操作，即系统在某个时间段是不可用的。这意味着不满足A
- 最终一致性，也是一种特殊的弱一致性，一般有五个变式。该一致性要求采取重试甚至人为干预，都可以让数据在最终达到一致。**即放弃实时一致，在一个时间窗口内数据会达到一致**

### ***A-可用性***
**有限时间内，返回结果**，对于不同的系统，有限时间的定义不同，也对返回结果的要求不同。

当系统满足可用性时，数据可能会出现不一致情况，最极端的分区情况，可能会形成节点孤岛，不同的节点将以它们所能获取到的数据进行操作。

## ***3. Base***
基于CAP理论的权衡，做到一个系统是符合BA(基本可用)，S（软件软状态），E（最终一致性）

### ***软状态***
节点允许数据存在中间状态，但该状态不会影响到系统的整体可用性

### ***基本可用***
出现不可预知的故障时，能损失掉部分可用性，但系统不至于完全不可用的情况

### ***最终一致性***
在经过一段时间的同步后，数据能达到最终一致
