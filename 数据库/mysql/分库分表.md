# 分库分表

做法：将原来独立的数据库拆分为若干数据库组成，将数据大表拆分为若干数据表组成，使得单一数据库、表的数据量变小，从而达到提升数据库性能的目的

效果：解决由于数据量过大，导致独立数据库性能降低的问题

# **1. 方向**

> [MySQL 对于千万级的大表要怎么优化？](https://www.zhihu.com/question/19719997/answer/81930332)

先做垂直切分，根据模块的耦合度，将一个大系统切分为多个小系统，即分布式系统。再考虑水平切分，将数据量分出去，因为sharding key的选择要合理，而且水平切分的成本较高

> [彻底搞清分库分表](https://blog.csdn.net/weixin_44062339/article/details/100491744)

按照文章的思路，分库分表的迭代过程为：垂直分表 -> 垂直分库 -> 水平分库 -> 水平分表

## **1.1 垂直切分**

### **1.1.1 垂直分表**

`垂直分表`：将一个表按照字段分成多个表，每个表存储其中一部分字段

表往往与某个业务模块对应，垂直分表相当于将业务模块进行切分，将大系统切分为多个小系统

数据项的访问频次并不一致，分为**热点字段**和**冷门字段**，垂直分表最典型地应用就是将**性能提升在热点数据的操作效率**，同理，**冷门数据也不会因为热点数据的高频次访问受到影响**，**减少锁表几率**

垂直拆分表的原则：

1. 将不常用的字段放在另外一张表中
2. 把text，blob等大字段拆分出来放在附表中（Dynamic完全行溢出是否还有意义？）
3. 经常组合查询的列放在一张表中（临时表的问题？）

提升：

1. 热点数据与冷门数据的操作解耦，减少互相之间的锁表概率，提升了热点数据操作效率的同时，降低冷门数据饥饿问题

2. 冷门数据往往可能是大字段text，varchar，blob，会导致I/O效率下降，分到不同的存储结构中，可以更好地提升热门数据的I/O效率，进一步提升操作效率（当然Dynamic使用完全行溢出的方式组织行，会在一定程度上缓解这个问题）

### **1.1.2 垂直分库**

`垂直分库`：按照业务将表进行分类，分布到不同的数据库上，每个库放在不同的服务器上，做到专库专用

库往往与某个服务器对应，垂直分库相当于将同一个物理机的CPU，内存，网络，IO，磁盘的竞争进行切分

垂直拆分库的原则：

1. 将业务耦合度较高的表分在同一个库
2. 根据业务的访问频次，分配不同的部署服务器性能

提升：

1. 去耦合，业务更清晰，对不同业务的数据进行分级管理

2. 高并发场景下，垂直分库可以一定程度提升I/O，数据库连接数，降低单机硬件的瓶颈，使得多个服务器共同分摊压力的效果，但**这种分摊并不是平均的，根据业务的访问热度决定**

## **1.2 水平切分**

水平切分又称为Sharding，它将**同一个库/表的记录**拆分到**多个结构相同**的库/表中，在获取数据时，通过**Sharding策略**映射获取。每一个结构相同的数据，我们称为**分片**。

Sharding策略有以下几种：
- 哈希取模：hash(key) % N
- 范围：可以是ID范围，也可以是时间范围
- 映射表：使用一个单独的数据库来存储映射关系

### **1.2.1 水平分库**



### **1.2.2 水平分表**

# **2. 使用场景**

# 参考
- [彻底搞清分库分表（垂直分库，垂直分表，水平分库，水平分表）](https://blog.csdn.net/weixin_44062339/article/details/100491744)